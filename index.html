<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="FitPlan">
<meta name="theme-color" content="#0f1a0f">
<title>FitPlan â€” Daily Fitness Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0b150b; --surface: #131f13; --surface2: #1a2b1a; --border: #2a3d2a;
    --green: #4ade80; --green-dim: #22543d; --green-glow: rgba(74,222,128,0.15);
    --amber: #fbbf24; --amber-dim: #78350f; --red: #f87171;
    --text: #e8f5e8; --text-dim: #6b8f6b; --text-muted: #3d5c3d;
    --run: #38bdf8; --run-dim: #0c4a6e; --rest: #a78bfa;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; overflow-x: hidden; }
  .app-header {
    position: sticky; top: 0; z-index: 100;
    background: rgba(11,21,11,0.92); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border); padding: 14px 20px 12px;
  }
  .header-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
  .app-title { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 22px; color: var(--green); letter-spacing: -0.5px; }
  .race-badge { background: linear-gradient(135deg, var(--amber-dim), #92400e); border: 1px solid var(--amber); border-radius: 20px; padding: 4px 12px; font-size: 11px; font-weight: 500; color: var(--amber); }
  .day-nav { display: flex; gap: 6px; overflow-x: auto; padding-bottom: 2px; scrollbar-width: none; }
  .day-nav::-webkit-scrollbar { display: none; }
  .day-btn { flex-shrink: 0; border: 1px solid var(--border); background: var(--surface); border-radius: 10px; padding: 6px 10px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-size: 11px; color: var(--text-dim); transition: all 0.2s; text-align: center; min-width: 44px; }
  .day-btn .day-label { font-weight: 600; display: block; font-size: 12px; }
  .day-btn .day-type { font-size: 9px; margin-top: 1px; display: block; }
  .day-btn.active { background: var(--green-glow); border-color: var(--green); color: var(--green); }
  .day-btn.today-dot { position: relative; }
  .day-btn.today-dot::after { content: ''; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; border-radius: 50%; background: var(--amber); }
  .main { padding: 16px; max-width: 480px; margin: 0 auto; padding-bottom: 100px; }
  .day-hero { background: var(--surface); border: 1px solid var(--border); border-radius: 18px; padding: 20px; margin-bottom: 16px; position: relative; overflow: hidden; }
  .day-hero::before { content: ''; position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; border-radius: 50%; background: var(--green-glow); pointer-events: none; }
  .hero-date { font-size: 12px; color: var(--text-dim); font-weight: 500; margin-bottom: 4px; }
  .hero-day { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 28px; color: var(--text); letter-spacing: -1px; }
  .hero-tags { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
  .tag { border-radius: 8px; padding: 4px 10px; font-size: 11px; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; }
  .tag-gym { background: var(--green-glow); color: var(--green); border: 1px solid var(--green-dim); }
  .tag-run { background: rgba(56,189,248,0.12); color: var(--run); border: 1px solid var(--run-dim); }
  .progress-wrap { margin-top: 14px; }
  .progress-label { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-dim); margin-bottom: 6px; }
  .progress-bar { height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--green), #86efac); border-radius: 3px; transition: width 0.5s ease; }
  .section { margin-bottom: 16px; }
  .section-header { display: flex; align-items: center; gap: 8px; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 13px; letter-spacing: 0.5px; text-transform: uppercase; color: var(--text-dim); margin-bottom: 10px; }
  .section-header::after { content: ''; flex: 1; height: 1px; background: var(--border); }
  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 14px 16px; margin-bottom: 8px; display: flex; gap: 12px; align-items: flex-start; transition: all 0.2s; cursor: pointer; }
  .card:active { transform: scale(0.98); }
  .card.checked { opacity: 0.55; }
  .card.checked .card-title { text-decoration: line-through; }
  .check-box { width: 22px; height: 22px; border-radius: 6px; border: 2px solid var(--border); flex-shrink: 0; margin-top: 1px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; background: var(--surface2); }
  .card.checked .check-box { background: var(--green); border-color: var(--green); }
  .check-icon { display: none; color: #000; font-size: 13px; font-weight: 700; }
  .card.checked .check-icon { display: block; }
  .card-body { flex: 1; min-width: 0; }
  .card-time { font-size: 10px; color: var(--text-dim); font-weight: 500; margin-bottom: 2px; letter-spacing: 0.3px; }
  .card-title { font-size: 14px; font-weight: 600; color: var(--text); line-height: 1.3; }
  .card-sub { font-size: 12px; color: var(--text-dim); margin-top: 4px; line-height: 1.5; }
  .card-detail { font-size: 11px; color: var(--text-muted); margin-top: 5px; font-style: italic; }
  .card-swap { font-size: 11px; color: var(--amber); margin-top: 4px; }
  .exercise-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; margin-bottom: 6px; display: flex; align-items: center; gap: 12px; cursor: pointer; transition: all 0.2s; }
  .exercise-card:active { transform: scale(0.98); }
  .exercise-card.checked { opacity: 0.5; }
  .exercise-card.checked .ex-name { text-decoration: line-through; }
  .ex-num { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 13px; color: var(--text-muted); min-width: 22px; }
  .ex-info { flex: 1; }
  .ex-name { font-size: 13px; font-weight: 600; color: var(--text); }
  .ex-sets { font-size: 11px; color: var(--text-dim); margin-top: 2px; }
  .ex-check { width: 20px; height: 20px; border-radius: 5px; border: 2px solid var(--border); background: var(--surface2); display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 11px; color: #000; }
  .exercise-card.checked .ex-check { background: var(--green); border-color: var(--green); }
  .tip-card { background: linear-gradient(135deg, rgba(251,191,36,0.08), rgba(251,191,36,0.03)); border: 1px solid rgba(251,191,36,0.25); border-radius: 12px; padding: 12px 14px; margin-top: 4px; font-size: 12px; color: #d97706; line-height: 1.5; }
  .protein-bar { background: linear-gradient(135deg, rgba(74,222,128,0.08), rgba(74,222,128,0.03)); border: 1px solid var(--green-dim); border-radius: 12px; padding: 12px 14px; margin-bottom: 16px; }
  .protein-bar-title { font-size: 11px; color: var(--text-dim); margin-bottom: 6px; font-weight: 500; }
  .protein-amounts { display: flex; gap: 8px; flex-wrap: wrap; }
  .p-chip { background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; padding: 3px 8px; font-size: 11px; color: var(--green); font-weight: 600; }
  .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(11,21,11,0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-top: 1px solid var(--border); padding: 12px 20px 28px; display: flex; gap: 10px; max-width: 480px; margin: 0 auto; }
  .notif-btn { flex: 1; background: var(--green); color: #000; border: none; border-radius: 14px; padding: 14px; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 14px; cursor: pointer; transition: all 0.2s; }
  .notif-btn:active { transform: scale(0.97); }
  .notif-btn.enabled { background: var(--green-dim); color: var(--green); border: 1px solid var(--green); }
  .reset-btn { background: var(--surface2); color: var(--text-dim); border: 1px solid var(--border); border-radius: 14px; padding: 14px 16px; font-family: 'DM Sans', sans-serif; font-weight: 500; font-size: 13px; cursor: pointer; transition: all 0.2s; }
  .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px); background: var(--surface2); border: 1px solid var(--green); color: var(--green); padding: 10px 20px; border-radius: 30px; font-size: 13px; font-weight: 500; opacity: 0; transition: all 0.3s; z-index: 999; white-space: nowrap; }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>
<header class="app-header">
  <div class="header-top">
    <div class="app-title">FitPlan ğŸŒ¿</div>
    <div class="race-badge" id="raceBadge">ğŸ Loading...</div>
  </div>
  <div class="day-nav" id="dayNav"></div>
</header>
<main class="main" id="mainContent"></main>
<div class="bottom-bar">
  <button class="notif-btn" id="notifBtn" onclick="handleNotif()">ğŸ”” Enable Daily Reminder</button>
  <button class="reset-btn" onclick="resetDay()">â†º Reset</button>
</div>
<div class="toast" id="toast"></div>
<script>
// â”€â”€ MEALS (your actual routine, updated) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MEALS_GYM = [
  { time: '7:30 AM', title: 'Wake Up', sub: 'Warm water + 2 dates', detail: 'Dates = fast fuel before gym. Drink 500ml warm water.' },
  { time: '9:15 AM', title: 'Gym Session', sub: 'Train hard â€” 9:15 to 10:30 AM', detail: 'Sip water throughout. No food needed during session.' },
  { time: '10:45 AM', title: 'Post-Gym Protein Shake', sub: '1 scoop whey protein in water or milk', detail: 'âš¡ Most important window â€” drink within 30 mins of finishing gym' },
  { time: '11:15 AM', title: 'Breakfast', sub: 'Your oat muffin + 1 fruit (apple/papaya)', detail: 'âœ… Muffin is fine â€” oats, seeds, apricots are good. Skip the cashews here, save for later.\nâš¡ OPTIONAL: Add 2â€“3 eggs scrambled (+24g protein boost)' },
  { time: '12:00 PM', title: 'Coffee', sub: 'Black coffee or with a small splash of milk', detail: 'Keep sugar-free. Green tea is fine too.' },
  { time: '1:30 PM', title: 'Lunch', sub: '70g quinoa + 130g chicken + 150g curd + 10g chia seeds', detail: 'â†‘ Bump chicken from 100g to 130g â€” you need more protein\nğŸ”„ Swap: Dal + sabzi on non-chicken days' },
  { time: '4:30 PM', title: 'Evening Snack', sub: '1 fruit (apple, orange, or papaya) + small handful cashews', detail: 'ğŸ”„ Replace crackers with fruit. Fruit = fibre + natural sugar. Much better.' },
  { time: '5:00 PM', title: 'Green Tea', sub: 'Plain green tea â€” no sugar', detail: 'Good for metabolism and belly fat reduction' },
  { time: '8:00 PM', title: 'Dinner', sub: '130g chicken OR dosa (150g batter) with coconut chutney', detail: 'Dosa nights: add sambar or dal on the side for protein\nChicken nights: 1 roti is fine â€” keep it whole wheat' },
  { time: '10:00 PM', title: 'Before Bed â­', sub: '150g hung curd / Greek yogurt OR warm haldi milk', detail: 'You are currently skipping this â€” DO NOT skip!\nCasein protein from curd repairs muscles all night. Critical at age 42.' },
];

const MEALS_RUN = [
  { time: '7:30 AM', title: 'Wake Up', sub: 'Warm water + 2 dates', detail: 'Light fuel before running. Eat 30â€“45 mins before you start.' },
  { time: '8:15 AM', title: 'Run Session', sub: 'Follow Runna plan', detail: 'Sip water. Pinch of salt + lemon in 500ml for longer runs.' },
  { time: '9:30 AM', title: 'Post-Run Protein', sub: '1 scoop whey protein + 1 fruit', detail: 'âš¡ Eat within 45 mins of finishing. Critical recovery window.' },
  { time: '10:15 AM', title: 'Breakfast', sub: 'Your oat muffin + hung curd 150g', detail: 'OPTIONAL: 2â€“3 eggs scrambled for extra protein boost' },
  { time: '12:00 PM', title: 'Coffee / Green Tea', sub: 'Black or light milk â€” no sugar', detail: 'Good caffeine timing â€” 2-3 hrs after running' },
  { time: '1:30 PM', title: 'Lunch', sub: '70g quinoa + 130g chicken + 150g curd + chia seeds', detail: 'ğŸ”„ Swap: Dal + sabzi + extra curd on non-chicken days' },
  { time: '4:30 PM', title: 'Evening Snack', sub: '1 fruit + small handful cashews (10â€“12 pieces)', detail: 'Ditch the crackers â€” fruit gives natural energy + fibre' },
  { time: '5:00 PM', title: 'Green Tea', sub: 'Plain â€” no sugar', detail: '' },
  { time: '8:00 PM', title: 'Dinner', sub: '130g chicken OR dosa (150g batter) + coconut chutney + sambar', detail: 'Run days: add sambar/dal alongside dosa for protein\nGoat meat is a great swap 2â€“3x per week' },
  { time: '10:00 PM', title: 'Before Bed â­', sub: '150g hung curd OR warm haldi milk', detail: 'Especially important on run days â€” inflammation recovery happens overnight' },
];

const MEALS_LONG_RUN = [
  { time: '7:30 AM', title: 'Wake Up', sub: 'Warm water + 3 dates (extra today)', detail: 'Long run needs more carb fuel. Eat 45 mins before start.' },
  { time: '8:15 AM', title: 'Long Run', sub: 'Follow Runna plan â€” longest of week', detail: 'Carry water. For runs over 8 miles, take 1â€“2 dates or energy gel mid-run.' },
  { time: '10:00 AM', title: 'Post-Run Recovery', sub: '1 scoop whey protein + 1 banana or fruit', detail: 'âš¡ Do not skip â€” this is the most critical meal of your week.' },
  { time: '10:45 AM', title: 'Breakfast (Bigger today)', sub: 'Your oat muffin + hung curd 150g + 1 extra fruit', detail: 'OPTIONAL: 2â€“3 eggs for extra protein. Long run = more food today.' },
  { time: '1:30 PM', title: 'Lunch (Bigger carbs today)', sub: '90g quinoa (extra) + 130g chicken + 150g curd + chia seeds', detail: 'Slightly larger carb portion â€” glycogen fully depleted from long run' },
  { time: '4:30 PM', title: 'Evening Snack', sub: '1 fruit + cashews + 1 extra date', detail: 'Extra fuel today â€” your body is still recovering' },
  { time: '5:00 PM', title: 'Green Tea', sub: 'Plain green tea', detail: '' },
  { time: '8:00 PM', title: 'Dinner', sub: '130g chicken + 1 roti OR dosa + coconut chutney + sambar', detail: 'Add sambar/dal â€” omega-3 fish is ideal on long run nights if possible' },
  { time: '10:00 PM', title: 'Before Bed â­ (Critical)', sub: '150g hung curd + pinch of haldi', detail: 'Do NOT skip tonight. Muscle repair for long run happens 90% during sleep.' },
];

// â”€â”€ PLAN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PLAN = {
  0: {
    name: 'Sunday', emoji: 'ğŸŒ¤',
    tags: [{label:'ğŸ’ª Strength + Core', cls:'tag-gym'}],
    gym: {
      title: 'Full Body Light + Core',
      note: '40 mins max. Low weight, controlled form. Energising â€” not exhausting.',
      exercises: [
        { name: 'Goblet Squats', sets: '3 sets Ã— 12 reps', note: 'Light weight, controlled tempo' },
        { name: 'Push-ups', sets: '3 sets Ã— 15 reps', note: 'Chest to floor, full range' },
        { name: 'Dumbbell Rows', sets: '3 sets Ã— 12 reps each arm', note: 'Squeeze at the top' },
        { name: 'Plank', sets: '3 sets Ã— 45 seconds', note: 'Core stability for running posture' },
        { name: 'Dead Bug', sets: '3 sets Ã— 10 reps', note: 'Anti-rotation, slow and controlled' },
        { name: 'Bicycle Crunches', sets: '3 sets Ã— 20 reps', note: 'Targets belly fat area' },
      ]
    },
    meals: MEALS_GYM,
    protein: ['Whey 25g', 'Chicken 32g', 'Curd 12g', 'Quinoa 9g', 'Muffin 6g', 'Total ~130g']
  },
  1: {
    name: 'Monday', emoji: 'ğŸ”¥',
    tags: [{label:'ğŸ’ª Upper Body', cls:'tag-gym'}],
    gym: {
      title: 'Upper Body â€” Heavy',
      note: 'Go heavy. Last 2 reps of each set should be genuinely hard. 60â€“90 sec rest between sets.',
      exercises: [
        { name: 'Bench Press / Dumbbell Press', sets: '4 sets Ã— 8 reps', note: 'Go heavy, last 2 reps hard' },
        { name: 'Bent Over Rows', sets: '4 sets Ã— 8 reps', note: 'Full range of motion' },
        { name: 'Overhead Press', sets: '3 sets Ã— 10 reps', note: 'Seated or standing' },
        { name: 'Pull-ups / Lat Pulldown', sets: '3 sets Ã— 10 reps', note: 'Use assistance band if needed' },
        { name: 'Bicep Curl', sets: '3 sets Ã— 12 reps', note: 'Controlled tempo, no swinging' },
      ]
    },
    meals: MEALS_GYM,
    protein: ['Whey 25g', 'Chicken 32g', 'Curd 12g', 'Quinoa 9g', 'Muffin 6g', 'Total ~130g']
  },
  2: {
    name: 'Tuesday', emoji: 'ğŸƒ',
    tags: [{label:'ğŸƒ Run Day', cls:'tag-run'}],
    run: { title: 'Easy / Moderate Run', note: 'Follow Runna plan. Easy conversational pace â€” hold a full conversation. ~3.5 miles.' },
    meals: MEALS_RUN,
    protein: ['Whey 25g', 'Chicken 32g', 'Curd 12g', 'Quinoa 9g', 'Muffin 6g', 'Total ~130g']
  },
  3: {
    name: 'Wednesday', emoji: 'âš¡',
    tags: [{label:'ğŸƒ Long Run', cls:'tag-run'}],
    run: { title: 'Longest Run of the Week', note: 'Follow Runna plan. Easy pace throughout. No gym today. Build from 5 miles now to 12 miles by Week 8.' },
    meals: MEALS_LONG_RUN,
    protein: ['Whey 25g', 'Chicken 32g', 'Curd 12g', 'Quinoa 11g', 'Total ~130g']
  },
  4: {
    name: 'Thursday', emoji: 'ğŸ¦µ',
    tags: [{label:'ğŸ’ª Lower Body', cls:'tag-gym'}],
    gym: {
      title: 'Lower Body â€” Moderate',
      note: 'âš ï¸ Do NOT go to failure. Legs must recover to run on Friday. Moderate weight, controlled form.',
      exercises: [
        { name: 'Squats', sets: '4 sets Ã— 10 reps', note: 'Moderate weight â€” not max effort' },
        { name: 'Romanian Deadlift', sets: '3 sets Ã— 10 reps', note: 'Hamstring focus, slow eccentric' },
        { name: 'Walking Lunges', sets: '3 sets Ã— 12 reps each leg', note: 'Single-leg stability for running' },
        { name: 'Calf Raises', sets: '4 sets Ã— 15 reps', note: 'Runner essential â€” do not skip' },
        { name: 'Glute Bridges', sets: '3 sets Ã— 15 reps', note: 'Activates glutes for better running form' },
      ]
    },
    meals: MEALS_GYM,
    protein: ['Whey 25g', 'Chicken 32g', 'Curd 12g', 'Quinoa 9g', 'Muffin 6g', 'Total ~130g']
  },
  5: {
    name: 'Friday', emoji: 'ğŸ’¨',
    tags: [{label:'ğŸƒ Tempo Run', cls:'tag-run'}],
    run: { title: 'Tempo / Interval Run', note: 'Follow Runna plan. Comfortably hard pace â€” breathing heavy but not sprinting. ~3.5 miles.' },
    meals: MEALS_RUN,
    protein: ['Whey 25g', 'Chicken 32g', 'Curd 12g', 'Quinoa 9g', 'Muffin 6g', 'Total ~130g']
  },
  6: {
    name: 'Saturday', emoji: 'ğŸ’ª',
    tags: [{label:'ğŸ’ª Upper Body', cls:'tag-gym'}],
    gym: {
      title: 'Upper Body â€” Volume',
      note: 'Lighter than Monday, more reps. Focus on the pump. 45 mins, keep moving.',
      exercises: [
        { name: 'Incline Dumbbell Press', sets: '3 sets Ã— 12 reps', note: 'Lighter than Monday, controlled' },
        { name: 'Cable / Dumbbell Rows', sets: '4 sets Ã— 12 reps', note: 'Builds back thickness' },
        { name: 'Lateral Raises', sets: '3 sets Ã— 15 reps', note: 'Shoulder width and definition' },
        { name: 'Face Pulls / Rear Delt Fly', sets: '3 sets Ã— 15 reps', note: 'Posture + shoulder health' },
        { name: 'Tricep Dips / Pushdown', sets: '3 sets Ã— 12 reps', note: 'Superset with biceps if short on time' },
      ]
    },
    meals: MEALS_GYM,
    protein: ['Whey 25g', 'Chicken 32g', 'Curd 12g', 'Quinoa 9g', 'Muffin 6g', 'Total ~130g']
  }
};

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentDay = new Date().getDay();
let checked = {};
function storageKey(day) { return `fitplan_checked_d${day}`; }
function loadChecked(day) { try { return JSON.parse(localStorage.getItem(storageKey(day)) || '{}'); } catch { return {}; } }
function saveChecked(day, data) { try { localStorage.setItem(storageKey(day), JSON.stringify(data)); } catch {} }

// â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDayNav() {
  const nav = document.getElementById('dayNav');
  const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const today = new Date().getDay();
  nav.innerHTML = dayNames.map((d, i) => {
    const plan = PLAN[i];
    const typeIcon = plan.gym && plan.run ? 'ğŸ’ªğŸƒ' : plan.gym ? 'ğŸ’ª' : plan.run ? 'ğŸƒ' : 'ğŸ˜´';
    return `<button class="day-btn ${i === currentDay ? 'active' : ''} ${i === today ? 'today-dot' : ''}" onclick="switchDay(${i})">
      <span class="day-label">${d}</span>
      <span class="day-type">${typeIcon}</span>
    </button>`;
  }).join('');
}

function renderRaceBadge() {
  const race = new Date('2025-04-25');
  const today = new Date();
  const days = Math.ceil((race - today) / 86400000);
  const badge = document.getElementById('raceBadge');
  if (days > 0) badge.textContent = `ğŸ ${days}d to race`;
  else if (days === 0) badge.textContent = 'ğŸ Race Day!';
  else badge.textContent = 'ğŸ… Race Complete!';
}

function renderDay(dayIdx) {
  const plan = PLAN[dayIdx];
  checked = loadChecked(dayIdx);
  const main = document.getElementById('mainContent');
  const today = new Date();
  const dateStr = dayIdx === new Date().getDay()
    ? `Today, ${today.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}`
    : plan.name;

  let html = '';

  // hero
  html += `<div class="day-hero">
    <div class="hero-date">${dateStr}</div>
    <div class="hero-day">${plan.emoji} ${plan.name}</div>
    <div class="hero-tags">${plan.tags.map(t => `<span class="tag ${t.cls}">${t.label}</span>`).join('')}</div>
    <div class="progress-wrap">
      <div class="progress-label"><span>Today's progress</span><span id="progressText">0%</span></div>
      <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
    </div>
  </div>`;

  // protein summary
  html += `<div class="protein-bar">
    <div class="protein-bar-title">âš¡ Protein sources today</div>
    <div class="protein-amounts">${plan.protein.map(p => `<span class="p-chip">${p}</span>`).join('')}</div>
  </div>`;

  // gym section
  if (plan.gym) {
    html += `<div class="section">
      <div class="section-header"><span>ğŸ’ª</span> Gym â€” ${plan.gym.title}</div>
      <div class="tip-card">ğŸ’¡ ${plan.gym.note}</div>`;
    plan.gym.exercises.forEach((ex, i) => {
      const key = `gym_${i}`;
      const ck = checked[key] ? 'checked' : '';
      html += `<div class="exercise-card ${ck}" onclick="toggleCheck('${key}', this)">
        <div class="ex-num">${String(i+1).padStart(2,'0')}</div>
        <div class="ex-info">
          <div class="ex-name">${ex.name}</div>
          <div class="ex-sets">${ex.sets} Â· ${ex.note}</div>
        </div>
        <div class="ex-check">${checked[key] ? 'âœ“' : ''}</div>
      </div>`;
    });
    html += `</div>`;
  }

  // run section
  if (plan.run) {
    html += `<div class="section">
      <div class="section-header"><span>ğŸƒ</span> Running</div>
      <div class="card ${checked['run'] ? 'checked' : ''}" onclick="toggleCheck('run', this)">
        <div class="check-box"><span class="check-icon">âœ“</span></div>
        <div class="card-body">
          <div class="card-title">${plan.run.title}</div>
          <div class="card-sub">${plan.run.note}</div>
          <div class="card-detail">ğŸ“± Open Runna app for today's session</div>
        </div>
      </div>
    </div>`;
  }

  // meals section
  html += `<div class="section"><div class="section-header"><span>ğŸ½ï¸</span> Meals & Schedule</div>`;
  plan.meals.forEach((meal, i) => {
    const key = `meal_${i}`;
    const ck = checked[key] ? 'checked' : '';
    const lines = meal.sub.split('\n');
    const detailLines = meal.detail ? meal.detail.split('\n') : [];
    html += `<div class="card ${ck}" onclick="toggleCheck('${key}', this)">
      <div class="check-box"><span class="check-icon">âœ“</span></div>
      <div class="card-body">
        <div class="card-time">${meal.time}</div>
        <div class="card-title">${meal.title}</div>
        ${lines.map((l,li) => `<div class="${li===0?'card-sub':'card-swap'}">${l}</div>`).join('')}
        ${detailLines.map(l => `<div class="card-detail">${l}</div>`).join('')}
      </div>
    </div>`;
  });
  html += `</div>`;

  // water
  html += `<div class="tip-card" style="margin-bottom:16px">
    ğŸ’§ 3â€“3.5 litres of water today.${plan.run ? ' Add pinch of salt + lemon to 500ml bottle for runs.' : ''}
    &nbsp; Start with 500ml warm water at 7:30 AM.
  </div>`;

  main.innerHTML = html;
  updateProgress(dayIdx);
}

function updateProgress(dayIdx) {
  const plan = PLAN[dayIdx];
  let total = 0, done = 0;
  if (plan.gym) { plan.gym.exercises.forEach((_, i) => { total++; if (checked[`gym_${i}`]) done++; }); }
  if (plan.run) { total++; if (checked['run']) done++; }
  plan.meals.forEach((_, i) => { total++; if (checked[`meal_${i}`]) done++; });
  const pct = total > 0 ? Math.round((done / total) * 100) : 0;
  const fill = document.getElementById('progressFill');
  const text = document.getElementById('progressText');
  if (fill) fill.style.width = pct + '%';
  if (text) text.textContent = pct + '%';
}

function toggleCheck(key, el) {
  checked[key] = !checked[key];
  saveChecked(currentDay, checked);
  el.classList.toggle('checked', checked[key]);
  const box = el.querySelector('.check-box, .ex-check');
  if (box) box.innerHTML = checked[key] ? 'âœ“' : '';
  updateProgress(currentDay);
  if (checked[key]) showToast('âœ“ Done!');
}

function switchDay(dayIdx) {
  currentDay = dayIdx;
  renderDayNav();
  renderDay(dayIdx);
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function resetDay() {
  checked = {};
  saveChecked(currentDay, {});
  renderDay(currentDay);
  showToast('â†º Day reset!');
}

// â”€â”€ NOTIFICATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let notifEnabled = localStorage.getItem('fitplan_notif') === 'true';

function updateNotifBtn() {
  const btn = document.getElementById('notifBtn');
  if (notifEnabled) {
    btn.textContent = 'ğŸ”” Reminder set â€” 8:30 AM âœ“';
    btn.classList.add('enabled');
  } else {
    btn.textContent = 'ğŸ”” Enable Daily Reminder';
    btn.classList.remove('enabled');
  }
}

async function handleNotif() {
  if (notifEnabled) {
    notifEnabled = false;
    localStorage.setItem('fitplan_notif', 'false');
    updateNotifBtn();
    showToast('Reminders turned off');
    return;
  }
  if (!('Notification' in window)) { showIOSFallback(); return; }
  try {
    const perm = await Notification.requestPermission();
    if (perm === 'granted') {
      notifEnabled = true;
      localStorage.setItem('fitplan_notif', 'true');
      updateNotifBtn();
      scheduleNotifications();
      showToast('ğŸ”” Daily reminder set for 8:30 AM!');
      setTimeout(() => {
        const today = PLAN[new Date().getDay()];
        new Notification(`FitPlan ğŸŒ¿ â€” ${today.emoji} ${today.name}`, {
          body: `${today.tags[0].label.replace(/[ğŸ’ªğŸƒğŸ˜´]/g,'').trim()} day! Check your plan. ğŸ’§ Start hydrating now.`
        });
      }, 1500);
    } else { showIOSFallback(); }
  } catch(e) { showIOSFallback(); }
}

function scheduleNotifications() {
  if (!notifEnabled || Notification.permission !== 'granted') return;
  const now = new Date();
  const next = new Date();
  next.setHours(8, 30, 0, 0); // 8:30 AM
  if (next <= now) next.setDate(next.getDate() + 1);
  const ms = next - now;
  setTimeout(() => {
    const today = PLAN[new Date().getDay()];
    new Notification(`FitPlan ğŸŒ¿ â€” ${today.emoji} ${today.name}`, {
      body: `${today.tags[0].label.replace(/[ğŸ’ªğŸƒğŸ˜´]/g,'').trim()} day! Open your plan. ğŸ’§ Warm water first.`
    });
    setInterval(scheduleNotifications, 86400000);
  }, ms);
}

function showIOSFallback() {
  const main = document.getElementById('mainContent');
  const existing = document.getElementById('iosFallback');
  if (existing) { existing.remove(); return; }
  const div = document.createElement('div');
  div.id = 'iosFallback';
  div.style.cssText = `background:linear-gradient(135deg,rgba(251,191,36,0.1),rgba(251,191,36,0.05));border:1px solid rgba(251,191,36,0.4);border-radius:16px;padding:16px;margin:0 0 16px;font-family:'DM Sans',sans-serif;`;
  div.innerHTML = `
    <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:14px;color:#fbbf24;margin-bottom:10px">ğŸ“± Set Up 8:30 AM Daily Reminder â€” Shortcuts App</div>
    <div style="font-size:12px;color:#92a892;line-height:2">
      <b style="color:#e8f5e8">1.</b> Open <b style="color:#e8f5e8">Shortcuts</b> app on iPhone<br>
      <b style="color:#e8f5e8">2.</b> Tap <b style="color:#e8f5e8">Automation</b> tab â†’ <b style="color:#e8f5e8">+</b> â†’ <b style="color:#e8f5e8">Personal Automation</b><br>
      <b style="color:#e8f5e8">3.</b> Tap <b style="color:#e8f5e8">Time of Day</b> â†’ set <b style="color:#4ade80">8:30 AM</b> â†’ Daily â†’ Next<br>
      <b style="color:#e8f5e8">4.</b> Search <b style="color:#e8f5e8">"Show Notification"</b> â†’ tap it<br>
      <b style="color:#e8f5e8">5.</b> Title: <b style="color:#4ade80">FitPlan ğŸŒ¿</b> Â· Body: <b style="color:#4ade80">Check today's plan!</b><br>
      <b style="color:#e8f5e8">6.</b> Next â†’ turn <b style="color:#f87171">OFF</b> "Ask Before Running" â†’ <b style="color:#e8f5e8">Done</b>
    </div>
    <div style="margin-top:10px;font-size:11px;color:#4ade80">âœ“ Fires every morning at 8:30 AM â€” after your sleep mode ends at 7 AM</div>
  `;
  main.insertBefore(div, main.firstChild);
  window.scrollTo({ top: 0, behavior: 'smooth' });
  showToast('ğŸ“‹ Shortcut setup guide shown â†‘');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderDayNav();
renderRaceBadge();
renderDay(currentDay);
updateNotifBtn();
if (notifEnabled) scheduleNotifications();
</script>
</body>
</html>
